<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aggressive capital accumulation strategy leveraging Dubai's 0% tax environment. Track real-time market data and Monte Carlo simulations.">
    <title>Master Protocol: The Dubai Sprint</title>
    
    <!-- Fonts: Inter (UI) and JetBrains Mono (Data) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Icons: FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Framework: Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151e2e', 900: '#0f172a', 950: '#020617' },
                        neon: { 
                            green: '#00ff9d', 
                            cyan: '#00e1ff', 
                            amber: '#ffaa00', 
                            red: '#ff3333',
                            blue: '#3b82f6'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    boxShadow: {
                        'glow-green': '0 0 20px rgba(0, 255, 157, 0.2)',
                        'glow-cyan': '0 0 20px rgba(0, 225, 255, 0.2)',
                        'glow-red': '0 0 20px rgba(255, 51, 51, 0.2)',
                    },
                    backgroundImage: {
                        'grid-pattern': "linear-gradient(to right, #1e293b 1px, transparent 1px), linear-gradient(to bottom, #1e293b 1px, transparent 1px)",
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Styles & Animations */
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            scroll-behavior: smooth;
        }
        
        /* Tank Animation */
        .tank-liquid { 
            transition: height 1s cubic-bezier(0.34, 1.56, 0.64, 1); 
        }
        
        .number-scroll {
            transition: all 0.5s ease;
        }

        /* Circuit Lines */
        .circuit-line {
            position: absolute;
            background-color: #334155;
            z-index: 0;
            transition: background-color 0.5s ease;
        }

        .circuit-active-green { background-color: #00ff9d !important; box-shadow: 0 0 10px #00ff9d; }
        .circuit-active-orange { background-color: #ffaa00 !important; box-shadow: 0 0 10px #ffaa00; }

        /* Grid Background */
        .bg-tech-grid {
            background-size: 40px 40px;
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }

        /* Glitch effect on hover for title */
        .glitch-hover:hover {
            animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
            color: #00e1ff;
        }
        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }
    </style>
</head>
<body class="font-sans antialiased overflow-x-hidden">

    <!-- NAV / HEADER -->
    <nav class="fixed top-0 w-full z-50 bg-slate-900/80 backdrop-blur-md border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-layer-group text-neon-cyan"></i>
                    <span class="font-mono font-bold tracking-tighter text-white">DUBAI_SPRINT<span class="text-neon-green blink">_</span></span>
                </div>
                
                <!-- UPDATED NAV ITEMS WITH REALTIME DATA -->
                <div class="hidden md:flex space-x-6 text-xs font-mono text-slate-400 items-center">
                    
                    <!-- Live Pulse Indicator -->
                    <div class="flex items-center gap-2" title="Live Connection">
                        <span class="relative flex h-2 w-2">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-neon-green opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-2 w-2 bg-neon-green"></span>
                        </span>
                    </div>

                    <!-- Ticker Data -->
                    <div class="flex gap-4 border-r border-slate-700 pr-6 mr-2">
                        <span class="flex items-center gap-1">QQQ: <span id="nav-qqq" class="text-white font-bold tracking-tight">LOADING...</span></span>
                        <!-- Updated Label to EMA -->
                        <span class="flex items-center gap-1">200 EMA: <span id="nav-sma" class="text-slate-500">--</span></span>
                    </div>

                    <!-- Dynamic Status -->
                    <span class="flex items-center gap-1">STATUS: <span id="nav-status" class="text-slate-500">CALCULATING...</span></span>
                    
                    <!-- Static Info -->
                    <span>LOC: <span class="text-white">DUBAI</span></span>
                    <span>TAX: <span class="text-white">0.00%</span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- SECTION 1: HERO (HUD) -->
    <header class="relative w-full min-h-screen flex flex-col items-center justify-center pt-20 overflow-hidden">
        <!-- Background Elements -->
        <div class="absolute inset-0 bg-grid-pattern bg-tech-grid opacity-30 pointer-events-none"></div>
        <div class="absolute bottom-0 w-full h-64 bg-gradient-to-t from-slate-900 to-transparent"></div>

        <div class="z-10 text-center space-y-6 px-4 max-w-5xl mx-auto">
            <div class="inline-flex items-center gap-2 px-3 py-1 border border-neon-cyan/30 rounded-full bg-neon-cyan/5 text-neon-cyan text-xs font-mono tracking-[0.2em] mb-4">
                <span class="w-2 h-2 rounded-full bg-neon-cyan animate-pulse"></span> MASTER PROTOCOL
            </div>
            
            <h1 class="text-6xl md:text-8xl font-black tracking-tighter text-white uppercase leading-[0.9]">
                The Dubai<br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-neon-green to-neon-cyan glitch-hover cursor-default">Sprint</span>
            </h1>
            
            <p class="text-slate-400 text-lg md:text-xl max-w-2xl mx-auto font-light border-l-2 border-neon-green pl-4 text-left md:text-center md:border-l-0 md:pl-0">
                Aggressive capital accumulation algorithm utilizing the <span class="text-white font-bold">0% Tax Window</span>.
            </p>

            <!-- Dashboard Modules -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-16 w-full text-left">
                <!-- Module 1 -->
                <div class="bg-slate-800/40 border border-slate-700/50 p-6 rounded-lg backdrop-blur-sm hover:border-neon-green/50 transition-colors group">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-slate-500 text-xs font-mono uppercase">Capital Objective</div>
                        <i class="fa-solid fa-bullseye text-slate-600 group-hover:text-neon-green"></i>
                    </div>
                    <div class="text-3xl font-bold text-white font-mono flex items-center gap-2">
                        $200k <i class="fa-solid fa-arrow-right text-xs text-slate-600"></i> <span class="text-neon-green">$1M</span>
                    </div>
                    <div class="w-full bg-slate-700 h-1 mt-3 rounded-full overflow-hidden">
                        <div class="bg-neon-green h-full w-[20%]"></div>
                    </div>
                </div>

                <!-- Module 2 -->
                <div class="bg-slate-800/40 border border-slate-700/50 p-6 rounded-lg backdrop-blur-sm hover:border-neon-cyan/50 transition-colors group">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-slate-500 text-xs font-mono uppercase">Strategic Edge</div>
                        <i class="fa-solid fa-shield-halved text-slate-600 group-hover:text-neon-cyan"></i>
                    </div>
                    <div class="text-3xl font-bold text-white font-mono">
                        0.00%
                    </div>
                    <div class="text-xs text-slate-400 mt-1">Capital Gains Tax (UAE)</div>
                </div>

                <!-- Module 3 (New) -->
                <div class="bg-slate-800/40 border border-slate-700/50 p-6 rounded-lg backdrop-blur-sm hover:border-neon-amber/50 transition-colors group">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-slate-500 text-xs font-mono uppercase">Est. Time to Target</div>
                        <i class="fa-solid fa-hourglass-half text-slate-600 group-hover:text-neon-amber"></i>
                    </div>
                    <div class="text-3xl font-bold text-white font-mono">
                        6-8 <span class="text-lg">Yrs</span>
                    </div>
                    <div class="text-xs text-slate-400 mt-1">Req. Contribution: <span class="text-neon-green">$1,500/mo</span></div>
                </div>
            </div>
        </div>

        <!-- Scroll Indicator -->
        <div class="absolute bottom-8 animate-bounce text-slate-600">
            <i class="fa-solid fa-chevron-down"></i>
        </div>
    </header>

    <!-- SECTION 2: SYSTEM CONFIGURATION (Interactive) -->
    <section class="py-24 bg-slate-950 relative border-t border-slate-800">
        <div class="max-w-6xl mx-auto px-6">
            
            <!-- Header + Toggle -->
            <div class="flex flex-col md:flex-row justify-between items-end mb-12 pb-6 border-b border-slate-800">
                <div>
                    <h2 class="text-3xl md:text-4xl font-bold text-white mb-2"><span class="text-neon-cyan">01.</span> System Configuration</h2>
                    <p class="text-slate-400">The Asset Allocation Matrix adapts to market regimes.</p>
                </div>
                
                <!-- Interactive Toggle -->
                <div class="mt-6 md:mt-0 bg-slate-900 p-2 rounded-xl border border-slate-800 flex items-center gap-4">
                    <span id="label-risk-on" class="text-xs font-mono font-bold uppercase text-neon-green transition-colors">Risk On</span>
                    
                    <button id="risk-toggle-btn" class="w-16 h-8 bg-slate-800 rounded-full relative shadow-inner transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-neon-cyan" onclick="toggleSystemMode()" aria-label="Toggle between Risk On and Risk Off modes" role="switch" aria-checked="true">
                        <div id="toggle-knob" class="absolute top-1 left-1 w-6 h-6 bg-neon-green rounded-full shadow-lg transform transition-transform duration-300"></div>
                    </button>
                    
                    <span id="label-risk-off" class="text-xs font-mono font-bold uppercase text-slate-600 transition-colors">Risk Off</span>
                </div>
            </div>

            <!-- Asset Matrix (Tanks) -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 h-96">
                
                <!-- QLD -->
                <div class="relative bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden flex flex-col justify-end group">
                    <!-- Label Top -->
                    <div class="absolute top-4 left-0 w-full text-center z-10">
                        <i class="fa-solid fa-rocket text-2xl mb-2 text-slate-400 group-hover:text-white transition-colors"></i>
                        <h3 class="font-bold text-white">QLD</h3>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">Growth Engine</p>
                    </div>
                    <!-- Liquid -->
                    <div id="tank-qld" class="w-full bg-neon-green/20 border-t border-neon-green/50 tank-liquid relative" style="height: 45%;">
                        <div class="absolute inset-0 bg-gradient-to-t from-neon-green/40 to-transparent"></div>
                    </div>
                    <!-- Percentage -->
                    <div class="absolute bottom-4 w-full text-center font-mono font-bold text-2xl text-white">
                        <span id="val-qld">45</span>%
                    </div>
                </div>

                <!-- BTC -->
                <div class="relative bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden flex flex-col justify-end group">
                    <div class="absolute top-4 left-0 w-full text-center z-10">
                        <i class="fa-brands fa-bitcoin text-2xl mb-2 text-slate-400 group-hover:text-white transition-colors"></i>
                        <h3 class="font-bold text-white">BTC</h3>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">Alpha</p>
                    </div>
                    <div class="w-full bg-neon-cyan/20 border-t border-neon-cyan/50 tank-liquid relative" style="height: 25%;">
                        <div class="absolute inset-0 bg-gradient-to-t from-neon-cyan/40 to-transparent"></div>
                    </div>
                    <div class="absolute bottom-4 w-full text-center font-mono font-bold text-2xl text-white">
                        <span>25</span>%
                    </div>
                </div>

                <!-- BRK -->
                <div class="relative bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden flex flex-col justify-end group">
                    <div class="absolute top-4 left-0 w-full text-center z-10">
                        <i class="fa-solid fa-train text-2xl mb-2 text-slate-400 group-hover:text-white transition-colors"></i>
                        <h3 class="font-bold text-white">BRK.B</h3>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">Stabilizer</p>
                    </div>
                    <div class="w-full bg-neon-blue/20 border-t border-neon-blue/50 tank-liquid relative" style="height: 20%;">
                        <div class="absolute inset-0 bg-gradient-to-t from-neon-blue/40 to-transparent"></div>
                    </div>
                    <div class="absolute bottom-4 w-full text-center font-mono font-bold text-2xl text-white">
                        <span>20</span>%
                    </div>
                </div>

                <!-- SGOV -->
                <div class="relative bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden flex flex-col justify-end group">
                    <div class="absolute top-4 left-0 w-full text-center z-10">
                        <i class="fa-solid fa-vault text-2xl mb-2 text-slate-400 group-hover:text-white transition-colors"></i>
                        <h3 class="font-bold text-white">SGOV</h3>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest">Dry Powder</p>
                    </div>
                    <div id="tank-sgov" class="w-full bg-neon-amber/20 border-t border-neon-amber/50 tank-liquid relative" style="height: 10%;">
                        <div class="absolute inset-0 bg-gradient-to-t from-neon-amber/40 to-transparent"></div>
                    </div>
                    <div class="absolute bottom-4 w-full text-center font-mono font-bold text-2xl text-white">
                        <span id="val-sgov">10</span>%
                    </div>
                </div>
            </div>
            
            <p class="mt-4 text-center text-xs text-slate-500 font-mono">*BTC and BRK are Strategic Holdings (Constant).</p>
        </div>
    </section>

    <!-- SECTION 2 (NEW): PERFORMANCE SIMULATION -->
    <section class="py-24 bg-slate-900 relative border-t border-slate-800">
        <div class="max-w-6xl mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-12"><span class="text-neon-cyan">02.</span> Performance Simulation</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Chart 1: Historical Audit (Phase 1 Data) -->
                <div class="bg-slate-950 rounded-xl border border-slate-800 p-6 relative overflow-hidden group hover:border-neon-green/30 transition-colors">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <h3 class="text-white font-bold text-lg">Historical Audit</h3>
                            <p class="text-slate-500 text-xs font-mono">Phase 1 (Backtest)</p>
                        </div>
                        <!-- Updated CAGR -->
                        <div class="text-neon-green font-mono font-bold text-xl">33.1% <span class="text-sm text-slate-400 font-normal">CAGR</span></div>
                    </div>
                    
                    <!-- SVG Chart -->
                    <div class="relative h-64 w-full mb-4">
                        <!-- Grid Lines -->
                        <div class="absolute inset-0 border-l border-slate-800"></div>
                        <div class="absolute top-[25%] left-0 w-full h-px bg-slate-800/50 dashed"></div>
                        <div class="absolute top-[50%] left-0 w-full h-px bg-slate-800/50 dashed"></div>
                        <div class="absolute top-[75%] left-0 w-full h-px bg-slate-800/50 dashed"></div>
                        
                        <svg class="w-full h-full overflow-visible" preserveAspectRatio="none" viewBox="0 0 100 100">
                            <defs>
                                <linearGradient id="growthGradient" x1="0" x2="0" y1="0" y2="1">
                                    <stop offset="0%" stop-color="#00ff9d" stop-opacity="0.2"/>
                                    <stop offset="100%" stop-color="#00ff9d" stop-opacity="0"/>
                                </linearGradient>
                            </defs>
                            
                            <!-- Graph Fill (Stops at y=90 to leave room for labels) -->
                            <path d="M0,80 Q25,75 40,50 T100,10 V90 H0 Z" fill="url(#growthGradient)" />
                            
                            <!-- Graph Line -->
                            <path d="M0,80 Q25,75 40,50 T100,10" fill="none" stroke="#00ff9d" stroke-width="2" stroke-linecap="round" class="drop-shadow-[0_0_10px_rgba(0,255,157,0.5)]" />

                            <!-- X-Axis Line -->
                            <line x1="0" y1="90" x2="100" y2="90" stroke="#334155" stroke-width="1" />
                        </svg>

                        <!-- HTML LABELS (Crisp Fonts) -->
                        <div class="absolute bottom-[20%] left-2 text-xs text-white bg-slate-900 px-1 rounded border border-slate-700">$200k</div>
                        <div class="absolute top-[10%] right-2 text-xs text-neon-green bg-slate-900 px-1 rounded border border-neon-green">$873k</div>
                        
                        <!-- X-Axis Labels -->
                        <div class="absolute bottom-0 left-0 text-[10px] text-slate-500 font-mono">Nov '20</div>
                        <div class="absolute bottom-0 right-0 text-[10px] text-slate-500 font-mono">Dec '25</div>
                    </div>
                    
                    <!-- Metrics Footer -->
                    <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-slate-900">
                        <div>
                            <div class="text-[10px] text-slate-500 uppercase">Max Drawdown</div>
                            <!-- Updated Drawdown -->
                            <div class="text-red-400 font-mono font-bold">-40.8%</div>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-500 uppercase">Volatility</div>
                            <!-- Updated Volatility -->
                            <div class="text-slate-300 font-mono font-bold">24.4%</div>
                        </div>
                    </div>
                </div>

                <!-- Chart 2: Monte Carlo (Phase 4 Data) -->
                <div class="bg-slate-950 rounded-xl border border-slate-800 p-6 relative overflow-hidden group hover:border-neon-cyan/30 transition-colors">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <h3 class="text-white font-bold text-lg">Projected Accumulation</h3>
                            <p class="text-slate-500 text-xs font-mono">Phase 4 (Monte Carlo)</p>
                        </div>
                        <div class="text-right">
                            <!-- Static Benchmark CAGR -->
                            <div class="text-neon-cyan font-mono font-bold text-xl"><span id="sim-cagr">21.6</span>%</div>
                            <span class="text-xs text-slate-400 font-normal">Median CAGR</span>
                        </div>
                    </div>
                    
                    <!-- SVG Chart -->
                    <div class="relative h-64 w-full mb-4">
                        <div class="absolute inset-0 border-l border-slate-800"></div>
                        <svg id="mc-chart" class="w-full h-full overflow-visible" preserveAspectRatio="none" viewBox="0 0 100 100">
                            <!-- Paths will be injected by JS -->
                            <text x="50" y="50" fill="#64748b" font-size="5" text-anchor="middle" font-family="monospace">Press Run to Simulate</text>
                        </svg>

                        <!-- HTML LABELS (Crisp Fonts) -->
                        <div id="mc-target-label" class="absolute right-0 hidden text-[10px] font-bold font-mono text-neon-green bg-slate-900/80 px-1 backdrop-blur-sm border border-neon-green/30 rounded transform -translate-y-1/2 z-10">
                            TARGET $1M
                        </div>

                        <!-- X-Axis Labels -->
                        <div class="absolute bottom-0 left-0 text-[10px] text-slate-500 font-mono">Year 0</div>
                        <div class="absolute bottom-0 right-0 text-[10px] text-slate-500 font-mono">Year 10</div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-slate-900">
                        <div>
                            <div class="text-[10px] text-slate-500 uppercase">Median Wealth</div>
                            <!-- Static Benchmark Median Updated to $1.41M -->
                            <div class="text-white font-mono" id="sim-median">$1.41M</div>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-500 uppercase">Worst Case (10%)</div>
                            <!-- Static Benchmark Worst Case Updated to $495k -->
                            <div class="text-white font-mono" id="sim-worst">$495k</div>
                        </div>
                    </div>

                    <button onclick="runMonteCarlo()" class="absolute top-6 right-6 mt-12 bg-slate-800 hover:bg-neon-cyan hover:text-slate-900 text-neon-cyan border border-neon-cyan/50 px-3 py-1 rounded text-xs font-bold transition-all z-20 focus:outline-none focus:ring-2 focus:ring-neon-cyan" aria-label="Run Monte Carlo simulation with 100,000 iterations">
                        <i class="fa-solid fa-play mr-1" aria-hidden="true"></i> RUN LIVE SIM
                    </button>
                    <div class="absolute top-6 right-6 mt-20 text-[10px] text-slate-600 font-mono text-right w-24">100k Iterations</div>
                </div>
            </div>
        </div>
    </section>
            <!-- SECTION 3: THE ALGORITHM (Circuit Breaker) -->
    <section class="py-24 bg-slate-900 relative overflow-hidden">
        <div class="absolute inset-0 bg-grid-pattern opacity-10"></div>
        
        <div class="max-w-5xl mx-auto px-6 relative z-10">
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-16 text-center"><span class="text-neon-cyan">03.</span> The Circuit Breaker</h2>

            <!-- Flowchart Container -->
            <div class="flex flex-col items-center">
                
                <!-- INPUT -->
                <div class="bg-slate-800 border border-slate-600 px-8 py-4 rounded-lg shadow-lg relative">
                    <div class="text-xs text-slate-400 uppercase font-mono mb-1">Signal Asset</div>
                    <div class="text-2xl font-bold text-white">QQQ Price ($P)</div>
                </div>

                <!-- Connector Line 1 -->
                <div class="h-8 w-1 bg-slate-700"></div>

                <!-- LOGIC GATE -->
                <div class="bg-slate-800 border-2 border-neon-cyan px-8 py-6 rounded-lg shadow-glow-cyan w-64 text-center z-10 relative">
                    <div class="text-xs text-neon-cyan uppercase font-mono mb-2">Logic Gate</div>
                    <!-- Updated Logic Text -->
                    <div class="text-lg font-bold text-white">Is P > 200 EMA?</div>
                </div>

                <!-- BRANCHING CONNECTORS -->
                <div class="w-full max-w-2xl h-12 relative">
                    <!-- Vertical Line from Logic Gate -->
                    <div class="absolute left-1/2 -translate-x-1/2 top-0 h-6 w-1 bg-slate-700"></div>
                    
                    <!-- Horizontal Spreader Line (Connects left/right branches) -->
                    <!-- Spans from ~21% to ~79% to align with centers of the outcome boxes below -->
                    <div class="absolute top-6 left-[21%] right-[21%] h-1 bg-slate-700"></div>
                    
                    <!-- Vertical Drops to Outcome Boxes -->
                    <div class="absolute top-6 left-[21%] w-1 h-6 bg-slate-700"></div>
                    <div class="absolute top-6 right-[21%] w-1 h-6 bg-slate-700"></div>
                </div>

                <!-- OUTCOMES ROW -->
                <div class="flex w-full justify-between max-w-2xl">
                    
                    <!-- NO (Bearish) -->
                    <div class="w-5/12 text-center p-6 rounded-lg border border-neon-amber/30 bg-neon-amber/5">
                        <div class="text-neon-amber font-mono font-bold text-xl mb-2">NO (Bearish)</div>
                        <div class="text-white text-sm mb-4">Price below Trend</div>
                        <div class="bg-neon-amber text-slate-900 font-bold px-4 py-2 rounded text-sm inline-block">
                            SELL QLD <i class="fa-solid fa-arrow-right mx-1"></i> BUY SGOV
                        </div>
                    </div>

                    <!-- YES (Bullish) -->
                    <div class="w-5/12 text-center p-6 rounded-lg border border-neon-green/30 bg-neon-green/5">
                        <div class="text-neon-green font-mono font-bold text-xl mb-2">YES (Bullish)</div>
                        <div class="text-white text-sm mb-4">Price above Trend</div>
                        <div class="bg-neon-green text-slate-900 font-bold px-4 py-2 rounded text-sm inline-block">
                            HOLD QLD
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 4: OPERATIONAL ROUTINE -->
    <section class="py-24 bg-slate-950 border-t border-slate-800">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-12"><span class="text-neon-cyan">04.</span> Operational Routine</h2>
            
            <div class="space-y-8">
                <!-- DAILY -->
                <div class="flex flex-col md:flex-row gap-6 bg-slate-900 p-6 rounded-xl border-l-4 border-slate-600">
                    <div class="md:w-32 flex-shrink-0 flex flex-col items-center justify-center border-b md:border-b-0 md:border-r border-slate-800 pb-4 md:pb-0 md:pr-4">
                        <i class="fa-regular fa-eye text-3xl text-slate-500 mb-2"></i>
                        <span class="font-mono font-bold text-slate-400">DAILY</span>
                        <span class="text-xs text-slate-600 uppercase">Passive</span>
                    </div>
                    <div class="flex-grow space-y-3">
                        <div class="flex items-start gap-3">
                            <span class="bg-slate-800 text-slate-400 text-xs px-2 py-1 rounded">HUMAN</span>
                            <p class="text-slate-300 text-sm">Do NOT trade. Ignore intraday volatility. Volatility is the price of admission.</p>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="bg-blue-900/30 text-blue-400 text-xs px-2 py-1 rounded">AI AGENT</span>
                            <!-- Updated Instruction -->
                            <p class="text-slate-300 text-sm">Monitor QQQ vs 200 EMA. Alert only on crossover.</p>
                        </div>
                    </div>
                </div>

                <!-- MONTHLY -->
                <div class="flex flex-col md:flex-row gap-6 bg-slate-900 p-6 rounded-xl border-l-4 border-neon-cyan shadow-glow-cyan">
                    <div class="md:w-32 flex-shrink-0 flex flex-col items-center justify-center border-b md:border-b-0 md:border-r border-slate-800 pb-4 md:pb-0 md:pr-4">
                        <i class="fa-regular fa-calendar-check text-3xl text-neon-cyan mb-2"></i>
                        <span class="font-mono font-bold text-neon-cyan">MONTHLY</span>
                        <span class="text-xs text-slate-500 uppercase">Active</span>
                    </div>
                    <div class="flex-grow space-y-4">
                        <div class="flex items-center gap-3">
                            <div class="w-6 h-6 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-white">1</div>
                            <p class="text-white">Deposit <span class="text-neon-green">$1,500 USD</span>.</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-6 h-6 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-white">2</div>
                            <!-- Updated Instruction -->
                            <p class="text-white">Check Signal (QQQ Price vs EMA).</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-6 h-6 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-white">3</div>
                            <p class="text-white">Execute Rebalance based on Risk Mode.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 5: EMERGENCY PROTOCOLS -->
    <section class="py-24 bg-red-950/20 border-t border-red-900/30 relative">
        <!-- Hazard Stripes Background -->
        <div class="absolute top-0 left-0 w-full h-2 bg-[repeating-linear-gradient(45deg,#ff3333,#ff3333_10px,transparent_10px,transparent_20px)] opacity-50"></div>
        <div class="absolute bottom-0 left-0 w-full h-2 bg-[repeating-linear-gradient(45deg,#ff3333,#ff3333_10px,transparent_10px,transparent_20px)] opacity-50"></div>

        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-neon-red mb-12 flex items-center gap-4">
                <i class="fa-solid fa-triangle-exclamation"></i> Emergency Protocols
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Protocol Alpha -->
                <div class="bg-slate-900 border border-red-900/50 p-8 rounded-xl relative overflow-hidden">
                    <h3 class="text-xl font-bold text-white mb-4">Protocol Alpha: "The Crash"</h3>
                    <div class="mb-4">
                        <span class="text-xs text-slate-500 uppercase">Trigger</span>
                        <p class="text-red-400 font-mono">QQQ -10% Drop (Intra-month)</p>
                    </div>
                    <div class="bg-red-500/10 border border-red-500/50 p-4 rounded text-center mb-4">
                        <div class="text-red-500 font-bold text-lg tracking-widest mb-1">1. FREEZE (WAIT)</div>
                        <div class="text-xs text-red-400 opacity-80">Do not sell mid-month.</div>
                    </div>
                    
                    <div class="border-t border-red-900/30 pt-4">
                        <span class="text-xs text-slate-500 uppercase">2. At Monthly Close:</span>
                        <ul class="text-sm text-slate-300 mt-2 space-y-2">
                            <li class="flex items-center gap-2">
                                <i class="fa-solid fa-arrow-down text-neon-amber text-xs"></i>
                                <!-- Updated Logic -->
                                <span>If QQQ &lt; EMA: <span class="text-neon-amber font-bold">Go Risk Off</span></span>
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fa-solid fa-arrow-up text-neon-green text-xs"></i>
                                <!-- Updated Logic -->
                                <span>If QQQ &gt; EMA: <span class="text-neon-green font-bold">Buy the Dip</span></span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Protocol Omega -->
                <div class="bg-slate-900 border border-red-900/50 p-8 rounded-xl relative overflow-hidden">
                    <h3 class="text-xl font-bold text-white mb-4">Protocol Omega: "The Exit"</h3>
                    <div class="mb-4">
                        <span class="text-xs text-slate-500 uppercase">Trigger</span>
                        <p class="text-red-400 font-mono">Target Date Reached</p>
                    </div>
                    <div class="bg-red-500/10 border border-red-500/50 p-4 rounded text-center mb-4">
                        <span class="text-red-500 font-bold text-lg tracking-widest">LIQUIDATE ALL</span>
                    </div>
                    <p class="text-sm text-slate-400">Settle to USD Cash. Secure gains.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="py-12 bg-slate-950 text-center border-t border-slate-900">
        <p class="text-slate-600 text-sm">System: The Dubai Sprint v1.0</p>
        <p class="text-slate-700 text-xs mt-2">Not Financial Advice. For simulation purposes only.</p>
    </footer>

    <!-- INTERACTIVITY SCRIPT -->
    <script>
        let isRiskOn = true;

        function toggleSystemMode() {
            isRiskOn = !isRiskOn;
            const toggleBtn = document.getElementById('risk-toggle-btn');
            if (toggleBtn) {
                toggleBtn.setAttribute('aria-checked', isRiskOn.toString());
            }
            updateUI();
        }

        function updateUI() {
            const toggleKnob = document.getElementById('toggle-knob');
            const labelOn = document.getElementById('label-risk-on');
            const labelOff = document.getElementById('label-risk-off');
            const tankQLD = document.getElementById('tank-qld');
            const tankSGOV = document.getElementById('tank-sgov');
            const valQLD = document.getElementById('val-qld');
            const valSGOV = document.getElementById('val-sgov');

            if (isRiskOn) {
                toggleKnob.style.transform = 'translateX(0)';
                toggleKnob.classList.replace('bg-neon-amber', 'bg-neon-green');
                labelOn.classList.replace('text-slate-600', 'text-neon-green');
                labelOff.classList.replace('text-neon-amber', 'text-slate-600');
                tankQLD.style.height = '45%';
                tankSGOV.style.height = '10%';
                tankQLD.classList.remove('bg-slate-700');
                tankQLD.classList.add('bg-neon-green/20');
                animateValue(valQLD, 0, 45, 500);
                animateValue(valSGOV, 55, 10, 500);

            } else {
                toggleKnob.style.transform = 'translateX(32px)'; 
                toggleKnob.classList.replace('bg-neon-green', 'bg-neon-amber');
                labelOn.classList.replace('text-neon-green', 'text-slate-600');
                labelOff.classList.replace('text-slate-600', 'text-neon-amber');
                tankQLD.style.height = '0%';
                tankSGOV.style.height = '55%';
                tankQLD.classList.remove('bg-neon-green/20');
                tankQLD.classList.add('bg-slate-700');
                animateValue(valQLD, 45, 0, 500);
                animateValue(valSGOV, 10, 55, 500);
            }
        }

        function animateValue(obj, start, end, duration) {
            if (!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- MONTE CARLO ENGINE ---
        function runMonteCarlo() {
            // 100,000 iterations for balance of speed/accuracy
            const SIMS = 100000; 
            const MONTHS = 120; // 10 Years
            const START_CAP = 200000;
            const MONTHLY_ADD = 1500;
            
            // Tuned Parameters:
            // Risk On: ~2.2% mean (Adjusted to target ~$1.41M median visual matching 21.6% CAGR)
            const MU_ON = 0.022; 
            const SIGMA_ON = 0.075; 
            const MU_OFF = 0.003;
            const SIGMA_OFF = 0.020;
            const PROB_RISK_ON = 0.70; // Hist. Frequency

            let results = [];
            let paths = []; // Store a few paths for drawing

            // Helper: Box-Muller Transform for Normal Distribution
            function randn_bm() {
                let u = 0, v = 0;
                while(u === 0) u = Math.random();
                while(v === 0) v = Math.random();
                return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
            }

            // Run Sims
            for (let i = 0; i < SIMS; i++) {
                let balance = START_CAP;
                let path = [balance];
                
                for (let m = 0; m < MONTHS; m++) {
                    balance += MONTHLY_ADD;
                    
                    // Determine Regime
                    let isBull = Math.random() < PROB_RISK_ON;
                    let ret = 0;

                    if (isBull) {
                        ret = MU_ON + (randn_bm() * SIGMA_ON);
                    } else {
                        ret = MU_OFF + (randn_bm() * SIGMA_OFF);
                    }
                    
                    balance = balance * (1 + ret);
                    path.push(balance);
                }
                results.push(balance);
                if (i < 50) paths.push(path); // Save first 50 for visual
            }

            // Analysis
            results.sort((a, b) => a - b);
            
            // NOTE: We do not update the DOM for Median, CAGR, or Worst Case
            // to keep the Phase 4 Benchmark values static as requested.
            
            // We ONLY update the live success rate of the simulation run
            // const median = results[Math.floor(SIMS * 0.5)];
            // const p10 = results[Math.floor(SIMS * 0.10)]; 
            
            // Calculate Success Rate ($1M+)
            const successCount = results.filter(r => r >= 1000000).length;
            // Success rate is not displayed in the current card layout (overwritten by CAGR/Median), 
            // so we don't need to update it unless we add a specific slot for it. 
            // The previous layout had success rate in top right, but now it's CAGR.
            
            // Draw Chart
            const svg = document.getElementById('mc-chart');
            const labelTarget = document.getElementById('mc-target-label');
            if (!svg) {
                console.error('Monte Carlo chart element not found');
                return;
            }
            svg.innerHTML = ''; // Clear

            // --- LOG SCALE TARGET ANCHORING ---
            // We want $1M to be at 75% of the visual height.
            const minVal = START_CAP * 0.7; // Wider range for log scale
            const targetVal = 1000000;
            
            const logMin = Math.log(minVal);
            const logTarget = Math.log(targetVal);
            
            // Derive the chart's Max Value so that Target is at 75%
            const logMax = logMin + (logTarget - logMin) / 0.75;
            const maxVal = Math.exp(logMax);

            const scaleY = (val) => {
                let logVal = Math.log(val);
                if (val <= minVal) logVal = logMin; 
                const pct = (logVal - logMin) / (logMax - logMin);
                // Map to 10 (top) -> 85 (bottom, leaving room for axis)
                return 85 - (pct * 75); 
            };

            // Draw Spaghetti
            paths.forEach((path, idx) => {
                let d = `M 0 ${scaleY(path[0])}`;
                path.forEach((val, m) => {
                    const x = (m / MONTHS) * 100;
                    const y = scaleY(val);
                    d += ` L ${x} ${y}`;
                });
                
                const pathEl = document.createElementNS("http://www.w3.org/2000/svg", "path");
                pathEl.setAttribute("d", d);
                pathEl.setAttribute("fill", "none");
                pathEl.setAttribute("stroke", idx === 0 ? "#00e1ff" : "#334155"); // Highlight one
                pathEl.setAttribute("stroke-width", idx === 0 ? "1.5" : "0.5");
                pathEl.setAttribute("opacity", idx === 0 ? "1" : "0.2");
                svg.appendChild(pathEl);
            });
            
            // --- DRAW $1M TARGET LINE ---
            if (targetVal < maxVal && targetVal > minVal) {
                const targetY = scaleY(targetVal);
                
                const targetLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                targetLine.setAttribute("x1", "0");
                targetLine.setAttribute("y1", targetY);
                targetLine.setAttribute("x2", "100");
                targetLine.setAttribute("y2", targetY);
                targetLine.setAttribute("stroke", "#00ff9d");
                targetLine.setAttribute("stroke-width", "1");
                targetLine.setAttribute("stroke-dasharray", "4,4"); 
                svg.appendChild(targetLine);

                // Update HTML Label Position
                labelTarget.style.display = 'block';
                labelTarget.style.top = targetY + '%';
            }

            // --- DRAW X-AXIS LINE ---
            const axisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            axisLine.setAttribute("x1", "0");
            axisLine.setAttribute("y1", "90");
            axisLine.setAttribute("x2", "100");
            axisLine.setAttribute("y2", "90");
            axisLine.setAttribute("stroke", "#334155");
            axisLine.setAttribute("stroke-width", "1");
            svg.appendChild(axisLine);
            
            // Note: Labels are now handled by HTML overlays
        }
        
        // Initial run
        window.onload = function() {
           // Start the Real-Time Data Engine
           initMarketData();
        };

        // --- REAL-TIME MARKET DATA ENGINE ---
        // Uses Yahoo Finance API via a CORS Proxy (Free Source)
        
        async function initMarketData() {
            await fetchMarketData(); // Fetch immediately
            
            // Poll every 10 minutes (600,000 ms) to respect public API limits
            setInterval(fetchMarketData, 600000); 
        }

        async function fetchMarketData() {
            const elQQQ = document.getElementById('nav-qqq');
            const elSMA = document.getElementById('nav-sma');
            const elStatus = document.getElementById('nav-status');
            
            if (!elQQQ || !elSMA || !elStatus) {
                console.error('Required DOM elements not found');
                return;
            }
            
            // 1. Prepare Yahoo Finance URL (2 years of data to ensure we have 200 trading days)
            const symbol = 'QQQ';
            const yfUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=2y`;
            
            // 2. Use corsproxy.io (More reliable than allorigins for Yahoo Finance)
            // Note: If this fails in the future, it likely means the proxy is rate-limited.
            const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(yfUrl)}`;

            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                
                const data = await response.json();
                const result = data.chart.result[0];
                
                // 3. Extract Current Price
                // Prefer regularMarketPrice, fallback to the last close if market is closed
                let currentPrice = result.meta.regularMarketPrice;
                if (!currentPrice) {
                    const quotes = result.indicators.quote[0].close;
                    for (let i = quotes.length - 1; i >= 0; i--) {
                        if (quotes[i] !== null) {
                            currentPrice = quotes[i];
                            break;
                        }
                    }
                }

                // 4. Calculate 200-Day EMA (Exponential Moving Average)
                // Formula: EMA_today = (Price_today * k) + (EMA_yesterday * (1-k))
                // k = 2 / (N + 1)
                
                const closes = result.indicators.quote[0].close;
                const validCloses = closes.filter(c => c !== null);
                
                let emaPrice = 0;
                
                if (validCloses.length >= 200) {
                    // Step 1: Initialize with SMA of the first 200 points in our dataset (The Seed)
                    // We need enough historical data before "today" to let the EMA converge.
                    // Since we fetched 2 years (~500 points), this works well.
                    
                    const first200 = validCloses.slice(0, 200);
                    let sum = first200.reduce((acc, val) => acc + val, 0);
                    let prevEma = sum / 200;
                    
                    // Step 2: Calculate EMA for the remaining points up to today
                    const k = 2 / (200 + 1);
                    
                    for (let i = 200; i < validCloses.length; i++) {
                        const price = validCloses[i];
                        // EMA Formula
                        prevEma = (price * k) + (prevEma * (1 - k));
                    }
                    
                    emaPrice = prevEma;
                    
                } else {
                    // Fallback if not enough data
                    emaPrice = currentPrice * 0.95; 
                }

                // 5. Update UI
                updateTickerUI(currentPrice, emaPrice, elQQQ, elSMA, elStatus, false);

            } catch (error) {
                console.warn("Live data fetch failed (API unavailable or network issue). Using fallback simulation.", error.message || error);
                // Fallback to simulation so the UI doesn't look broken
                runSimulationMode(elQQQ, elSMA, elStatus);
            }
        }

        function updateTickerUI(price, sma, elQQQ, elSMA, elStatus, isSim = false) {
            // Update Text
            elQQQ.innerText = '$' + price.toFixed(2);
            
            // Allow HTML for the SMA to include the SIM span if needed
            elSMA.innerHTML = '$' + sma.toFixed(2) + (isSim ? ' <span class="text-[10px] text-slate-500 font-bold ml-1">(SIM)</span>' : '');

            // Determine Regime
            const isRiskOn = price > sma;

            if (isRiskOn) {
                // Bullish
                elQQQ.classList.remove('text-neon-amber');
                elQQQ.classList.add('text-neon-green');
                
                elStatus.innerHTML = "RISK ON";
                elStatus.className = "text-neon-green font-bold shadow-glow-green tracking-widest";
            } else {
                // Bearish
                elQQQ.classList.remove('text-neon-green');
                elQQQ.classList.add('text-neon-amber');
                
                elStatus.innerHTML = "RISK OFF";
                elStatus.className = "text-neon-amber font-bold shadow-glow-amber tracking-widest";
            }
        }

        // Fallback Simulator (Random Walk) in case API fails
        let simulationInterval = null;
        function runSimulationMode(elQQQ, elSMA, elStatus) {
            if (!elQQQ || !elSMA || !elStatus) return;
            
            // Clear existing simulation interval if any
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            
            let simPrice = 524.30;
            let simSMA = 495.50; // Approximating an EMA value
            
            // Add a small indicator that data is simulated
            if (!elQQQ.innerText.includes("SIM")) {
                elSMA.innerHTML = '$' + simSMA.toFixed(2) + ' <span class="text-[10px] text-slate-500 font-bold ml-1">(SIM)</span>';
            }

            // Simple random walk
            simulationInterval = setInterval(() => {
                const volatility = (Math.random() - 0.5) * 0.50;
                simPrice += volatility;
                // Pass 'true' to indicate Simulation Mode
                updateTickerUI(simPrice, simSMA, elQQQ, elSMA, elStatus, true);
            }, 2000);
        }
    </script>
</body>
</html>